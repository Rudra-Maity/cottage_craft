<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>profile</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <style>
        #profileImage {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: #512DA8;
            font-size: 35px;
            color: #fff;
            text-align: center;
            /* line-height: 150px; */
            margin-right: 30px;
            margin-bottom: 5%;
        }

        #pro {
            cursor: pointer;
        }

        /* Styles for tablets (landscape and portrait) */
        @media screen and (max-width: 724px) {

            .dis {
                display: none;
            }

        }

        /* Styles for mobile devices (portrait) */
        @media screen and (max-width: 458px) {

            .navSearch {
                display: none;
            }

            .sideSearch {
                display: flex;
                visibility: visible;
            }

            #profile {
                display: flex;
                visibility: visible;
            }
        }
    </style>
</head>

<body>
    <a  id="pro" class="dis d-flex " style="text-decoration: none; justify-content: center;">
        <div class="d-flex " style="justify-content: center;">

            <span style="visibility: hidden;" id="firstName"><%=doc.uname.fname%></span>
            <span id="lastName" style="visibility: hidden;"><%=doc.uname.lname%></span>
            <div id="profileImage"></div>
    </a>

    </div>
    <button id="toggleButton" type="submit" class="btn btn-primary">Update Your profile</button>
    <form  class="row g-3 shadow-lg p-3 mb-5 bg-body rounded mt-2"  id="profile"
        style="width: 95vw; margin-left: 2%;">
        <div class="col-md-6">
            <label for="fname" class="form-label">firstName </label>
            <input disabled type="text" class="form-control" id="fname" name="fname" value="<%=doc.uname.fname%>">
        </div>
        <div class="col-md-6">
            <label for="lname" class="form-label">lastName</label>
            <input disabled type="text" class="form-control" id="lname" name="lname" value="<%=doc.uname.lname%>">
        </div>
        <div class="col-md-6">
            <label for="inputEmail4" class="form-label">Email</label>
            <input disabled type="email" class="form-control" id="inputEmail4" name="umail"
                pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$" title="please enter valid email" value="<%=doc.umail%>">
        </div>
       
        <div class="col-md-6">
            <label for="phnone" class="form-label">phnone No.</label>
            <input disabled type="tel" class="form-control" id="phnone" name="phno"
            pattern="[6789][0-9]{9}" title="please enter valid pfone no" value="<%=doc.address.phno%>">
        </div>
        <div class="col-12">

            <label for="district" class="form-label">district</label>
            <input disabled type="text" class="form-control" id="district" placeholder="district of a state"
                name="district" value="<%=doc.address.district%>">
            <label for="landmark" class="form-label">landmark</label>
            <input disabled type="text" class="form-control" id="landmark" placeholder="landmark,area,school"
                name="landmark" value="<%=doc.address.landmark%>">
            <label for="street" class="form-label">street</label>
            <input disabled type="text" class="form-control" id="street" placeholder="roads" name="street" value="<%=doc.address.street%>">
        </div>

        <div class="col-md-4">
            <label for="inputState" class="form-label">State</label>
            <select disabled id="inputState" class="form-select" name="state">
                <option value="ANDAMAN & NICOBAR ISLANDS">ANDAMAN & NICOBAR ISLANDS</option>
                <option value="ANDHRA PRADESH">ANDHRA PRADESH</option>
                <option value="ARUNACHAL PRADESH">ARUNACHAL PRADESH</option>
                <option value="ASSAM">ASSAM</option>
                <option value="BIHAR">BIHAR</option>
                <option value="CHANDIGARH">CHANDIGARH</option>
                <option value="CHHATTISGARH">CHHATTISGARH</option>
                <option value="DADRA AND NAGAR HAVELI AND DAMAN AND DIU">DADRA AND NAGAR HAVELI AND DAMAN AND DIU
                </option>
                <option value="DELHI">DELHI</option>
                <option value="GOA">GOA</option>
                <option value="GUJARAT">GUJARAT</option>
                <option value="HARYANA">HARYANA</option>
                <option value="HIMACHAL PRADESH">HIMACHAL PRADESH</option>
                <option value="JAMMU & KASHMIR">JAMMU & KASHMIR</option>
                <option value="JHARKHAND">JHARKHAND</option>
                <option value="KARNATAKA">KARNATAKA</option>
                <option value="KERALA">KERALA</option>
                <option value="LADAKH">LADAKH</option>
                <option value="LASKSHADWEEP">LASKSHADWEEP</option>
                <option value="MADHYA PRADESH">MADHYA PRADESH</option>
                <option value="MAHARASHTRA">MAHARASHTRA</option>
                <option value="MANIPUR">MANIPUR</option>
                <option value="MEGHALAYA">MEGHALAYA</option>
                <option value="MIZORAM">MIZORAM</option>
                <option value="NAGALAND">NAGALAND</option>
                <option value="ODISHA">ODISHA</option>
                <option value="PUDUCHERRY">PUDUCHERRY</option>
                <option value="PUNJAB">PUNJAB</option>
                <option value="RAJASHAN">RAJASHAN</option>
                <option value="SIKKIM">SIKKIM</option>
                <option value="TAMIL NADU">TAMIL NADU</option>
                <option value="TELANGANA">TELANGANA</option>
                <option value="TRIPURA">TRIPURA</option>
                <option value="UTTAR PRADESH">UTTAR PRADESH</option>
                <option value="UTTARAKHAND">UTTARAKHAND</option>
                <option value="WEST BENGAL">WEST BENGAL</option>
            </select>
            </select>
        </div>
        <div class="col-md-2">
            <label for="pincode" class="form-label">pincode</label>
            <input disabled type="tel" class="form-control" id="pincode" name="pincode"value="<%=doc.address.pincode%>"" >
        </div>
        <div class="col-12">
            <div class="form-check">
                <input disabled class="form-check-input" type="checkbox" id="gridCheck">
                <label class="form-check-label" for="gridCheck">
                    Check me out
                </label>
            </div>
        </div>
        <div class="col-12">
            <button id="update" disabled type="submit" class="btn btn-primary">Update</button>
        </div>
        <p id="p"></p>
    </form>
    <script>
        $(document).ready(function () {
            var firstName = $('#firstName').text();
            var lastName = $('#lastName').text();
            var intials = $('#firstName').text().charAt(0) + $('#lastName').text().charAt(0);
            var profileImage = $('#profileImage').text(intials);
            $("#toggleButton").click(function () {
                var inputElement = $("input");
                var isDisabled = inputElement.prop("disabled");

                // Toggle the disabled state
                inputElement.prop("disabled", !isDisabled);

                // Toggle the CSS class
                if (!isDisabled) {
                    inputElement.addClass("disabled-input");
                } else {
                    inputElement.removeClass("disabled-input");
                }
                $("#update").prop("disabled", function (i, val) {
                    return !val;
                });

                var selectElement = $("#inputState");
                var isDisabledd = selectElement.prop("disabled");
                
                // Toggle the disabled state of the select
                selectElement.prop("disabled", !isDisabledd);

                // Toggle the disabled state of the options
                selectElement.find("option").prop("disabled", !isDisabledd);
            });
            });
    
    </script>
    <script src="/profile.js"></script>

    <script>
        document.getElementById('profile').addEventListener("submit",(e)=>{
            const input=document.getElementsByTagName("input");
        const inputState=document.getElementById('inputState');

        const details={
            'uname.fname':input[0].value,
            'uname.lname':input[1].value,
            'umail':input[2].value,
            'address.phno':input[3].value,
            'address.district':input[4].value,
            'address.landmark':input[5].value,
            'address.street':input[6].value,
            'address.state':inputState.value,
            'address.pincode':input[7].value
        }
        fetch('http://localhost:2000/api/v1/user/update/updateDetails',{
            method: 'POST',
            headers: {
                'Content-Type': 'application/json' // Set the content type to JSON if sending JSON data
            },
            body:JSON.stringify(details)
        })
        .then((data)=>{
            if(data.ok) return data.json()
        })
    .then((jsonData)=>{
        console.log(jsonData.url);
        if(jsonData.url) window.location.replace(jsonData.url)
        else document.getElementById('p').innerText='Please enter valid data'
    })
        })
        
    </script>
</body>

</html>